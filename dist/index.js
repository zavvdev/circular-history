var d=Object.defineProperty;var a=(t,e)=>d(t,"name",{value:e,configurable:!0});var g=["number","string","bigint","boolean","symbol","object"],u=0,i=-1,s={empty:Symbol("empty")},v=a(t=>g.includes(t),"isTypeAllowed"),m=a(t=>{var e=typeof t,o=e==="object"&&t!==null;return o||v(e)},"isValueTypeAllowed"),y=a((t,e)=>m(t)&&typeof t===e,"canCommit"),l=a(t=>t===void 0,"isItemEmpty"),f=a((t,e)=>t%e,"makeIndex"),r=new WeakMap;function n(t,e){if(typeof t!="number"||t<=0||!Number.isInteger(t))throw new Error(`Capacity must be a positive integer. Got "${t}".`);if(!v(e))throw new Error(`"${e}" is not allowed`);r.set(this,{navigationUpperBound:u,navigatedItemsCount:u,pointer:i,capacity:t,dataType:e,buffer:new Array(t)})}a(n,"CircularHistory");n.prototype.commit=function(t){var e=r.get(this),o=e.dataType;if(!y(t,o))throw new Error(`Type of ${t} is invalid. Expected "${o}", got "${t===null?"null":typeof t}".`);var p=e.capacity;e.navigationUpperBound>=p-1?(e.navigationUpperBound=p-1,e.navigatedItemsCount=p-1):e.navigatedItemsCount=++e.navigationUpperBound,e.buffer[f(++e.pointer,p)]=t};n.prototype.current=function(){var t=r.get(this);if(t.pointer===i)return s.empty;var e=t.buffer,o=t.pointer;return e[f(o,t.capacity)]};n.prototype.moveBackward=function(){var t=r.get(this);if(t.pointer===i+1){t.pointer=i;return}t.navigatedItemsCount===u||t.pointer===i||(t.pointer--,t.navigatedItemsCount--)};n.prototype.moveForward=function(){var t=r.get(this);if(t.navigatedItemsCount!==t.navigationUpperBound){if(t.pointer===i){t.pointer=i+1;return}t.pointer++,t.navigatedItemsCount++}};n.prototype.clear=function(){var t=r.get(this);t.navigatedItemsCount=u,t.navigationUpperBound=u,t.pointer=i,t.buffer=new Array(t.capacity)};n.prototype.dump=function(t=!1){var e=r.get(this),o=[...e.buffer];return t?o.filter(p=>!l(p)):o};n.prototype.getCurrentIndex=function(){var t=r.get(this);return f(t.pointer,t.capacity)};n.prototype.isStartReached=function(){var t=r.get(this);return t.navigatedItemsCount===u||t.pointer===i};n.prototype.isEndReached=function(){var t=r.get(this);return t.navigatedItemsCount===t.navigationUpperBound};n.FLAGS=s;export{n as CircularHistory};
